
<!doctype html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

    <title>Using the Tacho-Motor Class</title>
    
    <!-- Description content not available -->
    
    <link rel="alternate" type="application/atom+xml" href="/ev3dev.github.io/news/atom.xml" title="Atom feed">
    <link rel="icon" href="/ev3dev.github.io/favicon.ico" />

    <!-- Bootstrap styles -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="/ev3dev.github.io/stylesheets/bootstrap.css">

    <!-- Custom styles -->
    <link rel="stylesheet" href="/ev3dev.github.io/stylesheets/site-structure.css">
    <link rel="stylesheet" href="/ev3dev.github.io/stylesheets/landing-content.css">

    <!-- Template for search results -->
    <script type="text/html" id="search-result-template">
        <div class="search-result">
            <a data-href="href"><h4 data-content="title"></h4></a>
            <span data-content="breadcrumbs" class="search-result-breadcrumbs"></span>
            <span data-content="author" class="search-result-author"></span><br/>
        </div>
    </script>

    

    
        <!-- Google Analytics excluded: not an official site build -->
    
</head>


<body class="no-jumbotron ">

    <div id="header">
    <nav class="navbar navbar-default navbar-fixed-top">
        <div class="container-fluid container">
            <div class="navbar-header">
                <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target=".navbar-collapse" aria-expanded="false">
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
                <a class="navbar-brand" href="/ev3dev.github.io/">
                    <img id="brand-logo" src="/ev3dev.github.io/images/ev3dev_logo_white.png" alt="ev3dev logo" />
                </a>
            </div>
            <div class="collapse navbar-collapse">
                <ul class="nav navbar-nav" id="main-nav">
                    <li>
                        <a href="/ev3dev.github.io/docs/getting-started" title="Our Getting Started guide">Start Here</a>
                    </li>
                    <li>
                        <a href="/ev3dev.github.io/download" title="SD card images for ev3dev">Downloads</a>
                    </li>
                    <li class="dropdown">
                        <a class="dropdown-toggle" data-toggle="dropdown" title="Documentation on using ev3dev">
                            Documentation
                            <span class="caret"></span>
                        </a>
                        <ul class="dropdown-menu">
                            <li>
                                <a href="/ev3dev.github.io/docs/tutorials">Tutorials</a>
                            </li>
                            <li>
                                <a href="/ev3dev.github.io/docs/programming-languages">Programming Languages</a>
                            </li>
                            <li>
                                <a href="/ev3dev.github.io/docs/networking">Networking</a>
                            </li>
                            <li>
                                <a href="/ev3dev.github.io/docs/driver-overview">Hardware Drivers</a>
                            </li>
                            <li role="separator" class="divider"></li>
                            <li>
                                <a href="/ev3dev.github.io/docs">More...</a>
                            </li>
                        </ul>
                    </li>
                    <li>
                        <a href="/ev3dev.github.io/support" title="Get Help with ev3dev">Support</a>
                    </li>
                    <li>
                        <a href="/ev3dev.github.io/news" title="ev3dev news">News</a>
                    </li>
                    <li class="dropdown">
                        <a class="dropdown-toggle" data-toggle="dropdown" href="#">
                            Community
                            <span class="caret"></span>
                        </a>
                        <ul class="dropdown-menu">
                            <li>
                                <a href="/ev3dev.github.io/contribute" title="How to contribute to ev3dev">Contribute</a>
                            </li>
                            <li>
                                <a href="/ev3dev.github.io/share" title="Share the word on ev3dev with others">Share</a>
                            </li>
                            <li>
                                <a href="/ev3dev.github.io/projects" title="Discover projects that use ev3dev">Project showcase</a>
                            </li>
                        </ul>
                    </li>
                </ul>
                <!-- items below float right, so appear in reverse order -->
                <div id="search-container">
                    <form class="navbar-form navbar-right dropdown" onsubmit="return false;">
                        <input type="text" id="search-input" class="form-control" placeholder="Quick nav" autocomplete="off" />
                        <div class="dropdown-menu" id="search-dropdown">
                            <div class="search-results-container" id="search-no-data-warning">
                                <span class="glyphicon glyphicon-alert heading-icon" aria-hidden="true"></span>
                                We were unable to retrieve search data from the
                                server. Make sure that JavaScript is enabled and
                                that nothing is blocking network access.
                            </div>

                            <div class="search-results-container" id="search-results-docs">
                                <h2>In docs</h2>
                                <div data-content="docs-results">
                                    <div class="no-results-note">No results</div>
                                </div>
                            </div>

                            <div class="search-results-container" id="search-results-projects">
                                <h2>In projects</h2>
                                <div data-content="project-results">
                                    <div class="no-results-note">No results</div>
                                </div>
                            </div>

                            <div class="search-results-container" id="search-results-news">
                                <h2>In news</h2>
                                <div data-content="news-results">
                                    <div class="no-results-note">No results</div>
                                </div>
                            </div>

                            <div class="search-results-container" id="search-results-misc">
                                <h2>In other pages</h2>
                                <div data-content="misc-results">
                                    <div class="no-results-note">No results</div>
                                </div>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </nav>
</div>

    
    
    <div class="container">
        

<div class="page-header">
    
        <a class="btn btn-primary pull-right" href="https://github.com/ev3dev/ev3dev.github.io/edit/master/docs/tutorials/tacho-motors.md"><span class="glyphicon glyphicon-pencil"></span> Edit on Github</a>
    
    <h1>
        Using the Tacho-Motor Class
        <small></small>
    </h1>
</div>
    </div>
    
    
    <div class="container">
    
        <hr />
<div class="nav-dropdown-arrow">
    <div>
        

<ol class="breadcrumb" vocab="http://schema.org" typeof="BreadcrumbList">
    
    

    
        

        
        

        <li property="itemListElement" typeof="ListItem" class="">
            <a href="/ev3dev.github.io/docs/" property="item" typeof="WebPage">
                <span property="name">Documentation</span>
            </a>
            <meta property="position" content="1">
        </li>
        
    
        

        
        

        <li property="itemListElement" typeof="ListItem" class="">
            <a href="/ev3dev.github.io/docs/tutorials/" property="item" typeof="WebPage">
                <span property="name">Tutorials</span>
            </a>
            <meta property="position" content="2">
        </li>
        
    
        

        
        

        <li property="itemListElement" typeof="ListItem" class="active">
            <span href="/ev3dev.github.io/docs/tutorials/" property="item" typeof="WebPage">
                <span property="name">Using the Tacho-Motor Class</span>
            </span>
            <meta property="position" content="3">
        </li>
        
    
</ol>
    </div>
    
</div>
<hr />

<ul id="markdown-toc">
  <li><a href="#about-tachometers" id="markdown-toc-about-tachometers">About tachometers</a></li>
  <li><a href="#identifying-the-motor" id="markdown-toc-identifying-the-motor">Identifying the Motor</a></li>
  <li><a href="#resetting-the-motor" id="markdown-toc-resetting-the-motor">Resetting the Motor</a></li>
  <li><a href="#position-and-speed" id="markdown-toc-position-and-speed">Position and Speed</a></li>
  <li><a href="#running-the-motor" id="markdown-toc-running-the-motor">Running the Motor</a>    <ul>
      <li><a href="#run-forever" id="markdown-toc-run-forever">run-forever</a></li>
      <li><a href="#run-to-abs-pos" id="markdown-toc-run-to-abs-pos">run-to-abs-pos</a></li>
      <li><a href="#run-to-rel-pos" id="markdown-toc-run-to-rel-pos">run-to-rel-pos</a></li>
      <li><a href="#run-timed" id="markdown-toc-run-timed">run-timed</a></li>
      <li><a href="#run-direct" id="markdown-toc-run-direct">run-direct</a></li>
    </ul>
  </li>
  <li><a href="#stopping-the-motor" id="markdown-toc-stopping-the-motor">Stopping the Motor</a>    <ul>
      <li><a href="#coast" id="markdown-toc-coast">coast</a></li>
      <li><a href="#brake" id="markdown-toc-brake">brake</a></li>
      <li><a href="#hold" id="markdown-toc-hold">hold</a></li>
    </ul>
  </li>
  <li><a href="#polarity" id="markdown-toc-polarity">Polarity</a></li>
  <li><a href="#ramping" id="markdown-toc-ramping">Ramping</a></li>
  <li><a href="#state-flags" id="markdown-toc-state-flags">State Flags</a>    <ul>
      <li><a href="#running" id="markdown-toc-running">running</a></li>
      <li><a href="#ramping-1" id="markdown-toc-ramping-1">ramping</a></li>
      <li><a href="#holding" id="markdown-toc-holding">holding</a></li>
      <li><a href="#stalled" id="markdown-toc-stalled">stalled</a></li>
    </ul>
  </li>
</ul>

<p class="alert alert-danger"><span class="glyphicon glyphicon-exclamation-sign " aria-hidden="true"></span>
This tutorial has been updated for changes introduced in ev3dev kernel release
10. <strong>If you are running on an image file from before 2016-10-17 and have
not manually upgraded your kernel, you will need to upgrade before continuing.</strong>
You can check your kernel version by running <code class="highlighter-rouge">uname -r</code>. If it does not contain
<code class="highlighter-rouge">-10-ev3dev-</code> or higher, you are not running a supported version.</p>

<p>This tutorial uses a command line shell to demonstrate how to use the
<a href="/ev3dev.github.io/docs/drivers/tacho-motor-class">tacho-motor</a> class. Although there are many devices that can be used as tacho
motors, the most common ones are the EV3 Large motor, the
EV3 Medium motor, and the NXT motor.</p>

<h2 id="about-tachometers">About tachometers</h2>

<p>A <a href="https://en.wikipedia.org/wiki/Tachometer">tachometer</a> is a device that measures rotational speed. The LEGO MINDSTORMS
NXT and EV3 motors have an optical encoder that sends electrical pulses to the
EV3 when the motor rotates.</p>

<p>We call any motor that can see feedback like this a “tacho-motor”. Using this
feedback, you have greater control over the speed and position of the motor
compared to motors that do not provide feedback.</p>

<h2 id="identifying-the-motor">Identifying the Motor</h2>

<p>Always be sure to check the <code class="highlighter-rouge">address</code> attribute to identify a motor (same with
sensors). Here is a command that lists the <code class="highlighter-rouge">address</code> of all tacho motors…</p>

<div class="highlighter-rouge"><pre class="highlight"><code>$ for f in /sys/class/tacho-motor/*; do echo -n "$f: "; cat $f/address; done
/sys/class/tacho-motor/motor0: outA
/sys/class/tacho-motor/motor1: outB
/sys/class/tacho-motor/motor2: outC
/sys/class/tacho-motor/motor3: outD
/sys/class/tacho-motor/motor4: in4:i2c3:mux0
/sys/class/tacho-motor/motor5: in4:i2c3:mux1
</code></pre>
</div>

<p>I have a motor plugged into each of the four output ports of the EV3 (A-D) and
I also have a mindsensors.com NxtMMX plugged into input port 4 which provides
two additional motors. So, for example, if I want to control the motor attached
to output port C, then I need to use the path <code class="highlighter-rouge">/sys/class/tacho-motor/motor2</code>.</p>

<p>To save some typing, I’m going to define a variable for the motor path…</p>

<div class="highlighter-rouge"><pre class="highlight"><code>$ export MC=/sys/class/tacho-motor/motor2
</code></pre>
</div>

<p>Now we can just type <code class="highlighter-rouge">$MC</code> for the motor path.</p>

<h2 id="resetting-the-motor">Resetting the Motor</h2>

<p>The tacho-motor class has a <code class="highlighter-rouge">reset</code> command that resets all of the parameters
back to the default values and stops the motor. It is a good idea to send this
command at the start of a program to ensure the motor is in a known state without
having to write each of the parameters individually. Let’s do that first…</p>

<div class="highlighter-rouge"><pre class="highlight"><code>$ echo reset &gt; $MC/command
</code></pre>
</div>

<h2 id="position-and-speed">Position and Speed</h2>

<p>Unlike other MINDSTORMS software, the units of measurement used are in tachometer
counts rather than rotations or degrees. This can be tricky because for the NXT
and EV3 motors, one pulse of the tachometer = one degree. If you use a 3rd party
motor, it may be different.</p>

<p>Let’s start by looking at the <code class="highlighter-rouge">position</code> attribute…</p>

<div class="highlighter-rouge"><pre class="highlight"><code>$ cat $MC/position
0
</code></pre>
</div>

<p>If you have not rotated your motor since you plugged it in, it should say <code class="highlighter-rouge">0</code>.
If not, we can reset it with…</p>

<div class="highlighter-rouge"><pre class="highlight"><code>$ echo 0 &gt; $MC/position
</code></pre>
</div>

<p>Note: you will get an error if you do this while the motor is running.</p>

<p>Now, turn the motor one rotation by hand and read the position again…</p>

<div class="highlighter-rouge"><pre class="highlight"><code>$ cat $MC/position
345
</code></pre>
</div>

<p>It should be somewhere close to the value returned by the <code class="highlighter-rouge">count_per_rot</code>
(tachometer pulse counts per one rotation) attribute…</p>

<div class="highlighter-rouge"><pre class="highlight"><code>$ cat $MC/count_per_rot
360
</code></pre>
</div>

<p>Speed is similar in that the units are in tachometer pulse counts per second.
You can watch the speed by running…</p>

<div class="highlighter-rouge"><pre class="highlight"><code>$ while true; do echo -en "\033[0G$(cat $MC/speed)   "; done
</code></pre>
</div>

<p>… and then turn the motor by hand to watch the value change. You should see
numbers between +/-300 (unless you are not being nice to your motor and turning
it very fast). Press <code class="highlighter-rouge">^C</code> when you are done. Note: <code class="highlighter-rouge">\033[0G</code> is an escape code
that moves the cursor back to the beginning of the line so that we don’t fill up
the screen with numbers.</p>

<p>The range of <code class="highlighter-rouge">position</code> attribute is between -2,147,483,648 and +2,147,483,647 tachometer counts. It is unlikely that you will ever reach the limit.</p>

<h2 id="running-the-motor">Running the Motor</h2>

<p>The most obvious thing to do with a motor is make it run, so let’s do that first.</p>

<p>To run the motor, we need to send
it a command. To find out what commands are available, read the <code class="highlighter-rouge">commands</code> attribute.
Other motor controllers, such as the NxtMMX may not support all of the possible
commands, so it is always good to check this attribute.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>$ cat $MC/commands
run-forever run-to-abs-pos run-to-rel-pos run-timed run-direct stop reset
</code></pre>
</div>

<p>Let’s have a look at the <code class="highlighter-rouge">run-*</code> commands.</p>

<h3 id="run-forever">run-forever</h3>

<p>This command works like “Duration: unlimited” in NXT-G or “On” in EV3-G. The
motor will run until we send another command. So, let’s run it…</p>

<div class="highlighter-rouge"><pre class="highlight"><code>$ echo run-forever &gt; $MC/command
</code></pre>
</div>

<p>… and nothing happens. We forgot to tell it how fast to go. We do this by
setting the <code class="highlighter-rouge">speed_sp</code> to a value between 0 and <code class="highlighter-rouge">max_speed</code>…</p>

<div class="highlighter-rouge"><pre class="highlight"><code>$ echo 500 &gt; $MC/speed_sp
</code></pre>
</div>

<p>… and still nothing happens. This is because parameters only take effect when
we send a command. If we change a parameter, we have to send the command again
in order to apply the changes.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>$ echo run-forever &gt; $MC/command
</code></pre>
</div>

<p>… now the motor is running. Let’s make the motor turn in the opposite
direction, but a little slower. Using a negative value changes the direction…</p>

<div class="highlighter-rouge"><pre class="highlight"><code>$ echo -300 &gt; $MC/speed_sp
$ echo run-forever &gt; $MC/command
</code></pre>
</div>

<p>… and stop it…</p>

<div class="highlighter-rouge"><pre class="highlight"><code>$ echo stop &gt; $MC/command
</code></pre>
</div>

<h3 id="run-to-abs-pos">run-to-abs-pos</h3>

<p>This means “run to absolute position”. The position is specified by writing to
the <code class="highlighter-rouge">position_sp</code> attribute. Remember, the units are in tachometer pulse counts,
so if you are not using a LEGO motor, then you will need to do some math to
convert to/from degrees.</p>

<p>The <code class="highlighter-rouge">position_sp</code> should be at 0, so if we send this command, the motor will
run until the <code class="highlighter-rouge">position</code> is 0. If you have turned the motor many times, this
could take a while. We’ll add an extra command so we can watch the position
change.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>$ cat $MC/position_sp
0
$ echo run-to-abs-pos &gt; $MC/command
$ while true; do echo -en "\033[0G$(cat $MC/position)   "; done
</code></pre>
</div>

<p>Note: For <code class="highlighter-rouge">run-to-abs-pos</code> command only the absolute value of <code class="highlighter-rouge">speed_sp</code> matters.
The direction of movement is determined automatically.</p>

<h3 id="run-to-rel-pos">run-to-rel-pos</h3>

<p>This means “run to relative position”. Again, the position is specified by
<code class="highlighter-rouge">position_sp</code>, but this time the value is added to the current position. So,
if we run…</p>

<div class="highlighter-rouge"><pre class="highlight"><code>$ echo 180 &gt; $MC/position_sp
$ echo run-to-rel-pos &gt; $MC/command
</code></pre>
</div>

<p>… the motor will turn 1/2 of a turn. If we run…</p>

<div class="highlighter-rouge"><pre class="highlight"><code>$ echo run-to-rel-pos &gt; $MC/command
</code></pre>
</div>

<p>… again, the motor will turn an additional 1/2 turn.</p>

<p>Note: Using a negative value for <code class="highlighter-rouge">position_sp</code> will cause the motor to rotate
in the opposite direction. The sign of <code class="highlighter-rouge">speed_sp</code> is ignored like in <code class="highlighter-rouge">run-to-abs-pos</code> command.</p>

<h3 id="run-timed">run-timed</h3>

<p>This is an easy way to run the motor for a specified time asynchronously.
Essentially, it starts the motor using the <code class="highlighter-rouge">run-forever</code> command and sets a
timer in the kernel to run the <code class="highlighter-rouge">stop</code> command after the specified time. The
time, in milliseconds, is written to the <code class="highlighter-rouge">time_sp</code> attribute.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>$ echo 2000 &gt; $MC/time_sp
$ echo run-timed &gt; $MC/command
</code></pre>
</div>

<p>This will cause the motor to run for 2 seconds. Notice that writing to <code class="highlighter-rouge">command</code>
returns immediately. If you need to block the program from running while the
motor runs for a period of time, you should use the <code class="highlighter-rouge">run-forever</code> and <code class="highlighter-rouge">stop</code>
command along with the built-in time delay functions in your programming
language.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>$ run-for-time() { echo run-forever &gt; $MC/command; sleep $1; echo stop &gt; $MC/command; }
$ run-for-time 2
</code></pre>
</div>

<p>This function does not return until the time has elapsed (it runs synchronously).</p>

<p>Likewise, if you need your program to <em>not</em> block during the time delay, but you
need something to happen after the time delay, you should use the features of
your programming language for an asynchronous callback, like <code class="highlighter-rouge">setTimeout()</code> in
javascript.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>$ run-for-time() { echo run-forever &gt; $MC/command; (sleep $1; echo stop &gt; $MC/command;) &amp; }
$ run-for-time 2
</code></pre>
</div>

<h3 id="run-direct">run-direct</h3>

<p>This command works just like <code class="highlighter-rouge">run-forever</code> except that it uses <code class="highlighter-rouge">duty_cycle_sp</code>
instead of <code class="highlighter-rouge">speed_sp</code> <em>and</em> changes to <code class="highlighter-rouge">duty_cycle_sp</code>
take effect immediately instead of having to send a new command. This is useful
for implementing your own PID or something similar that needs to update the
motor output very quickly.</p>

<p>Note: Not all motor controller support this command.</p>

<p>So, like before, we can start the motor…</p>

<div class="highlighter-rouge"><pre class="highlight"><code>$ echo 20 &gt; $MC/duty_cycle_sp
$ echo run-direct &gt; $MC/command
</code></pre>
</div>

<p>But, this time when we change the duty cycle, the motor speed changes…</p>

<div class="highlighter-rouge"><pre class="highlight"><code>$ echo 30 &gt; $MC/duty_cycle_sp
</code></pre>
</div>

<h2 id="stopping-the-motor">Stopping the Motor</h2>

<p>As we have already seen, with the <code class="highlighter-rouge">run-to-*-pos</code> and <code class="highlighter-rouge">run-timed</code> commands, the
motor will stop automatically. For the other run commands, you have to send a
<code class="highlighter-rouge">stop</code> command to make the motor stop. The motor actually has three possible
behaviors when it stops. We can list them by reading the <code class="highlighter-rouge">stop_actions</code> attribute…</p>

<div class="highlighter-rouge"><pre class="highlight"><code>$ cat $MC/stop_actions
coast brake hold
</code></pre>
</div>

<p>Note: Some motor controllers may not support all of these, so it is a good idea
to always check this attribute.</p>

<h3 id="coast">coast</h3>

<p><code class="highlighter-rouge">coast</code> means that power will be removed from the motor and it will coast to a
stop. Let’s try it…</p>

<div class="highlighter-rouge"><pre class="highlight"><code>$ echo 1000 &gt; $MC/speed_sp
$ echo 1000 &gt; $MC/time_sp
$ echo coast &gt; $MC/stop_action
$ echo run-timed &gt; $MC/command
</code></pre>
</div>

<p>Notice how it takes the motor about 1 additional second to actually stop. Also,
try turning the motor by hand. It turns fairly easily.</p>

<h3 id="brake">brake</h3>

<p><code class="highlighter-rouge">brake</code> means to use passive braking, which is another way of saying that the
motor controller removes power from the motor, but it also shorts the power
wires of the motor together. When a motor is manually rotated, it acts as an
electrical generator, so shorting the power wires creates a load that absorbs
the energy.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>$ echo brake &gt; $MC/stop_action
$ echo run-timed &gt; $MC/command
</code></pre>
</div>

<p>Notice how much faster the motor stops this time. Also try turning it by hand.
The motor turns, but it is more difficult to turn.</p>

<h3 id="hold">hold</h3>

<p><code class="highlighter-rouge">hold</code> means to actively hold the motor position when stopping. Instead of
removing power from the motor, the motor controller will start a PID to prevent
the motor from being turned any farther. This stop command is really intended
for use with the <code class="highlighter-rouge">run-to-*-pos</code> commands. It will work with other run commands,
but may result in unexpected behavior.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>$ echo hold &gt; $MC/stop_action
$ echo 180 &gt; $MC/position_sp
$ echo run-to-rel-pos &gt; $MC/command
</code></pre>
</div>

<p>Try to turn the motor now. The motor might turn a small amount, but the more you
push, the more it will push back. You can actually see how hard the motor is
pushing back by reading the <code class="highlighter-rouge">duty_cycle</code> attribute. This attribute returns the
actual power being sent to the motor (0 to +/-100%)…</p>

<div class="highlighter-rouge"><pre class="highlight"><code>$ while true; do echo -en "\033[0G$(cat $MC/duty_cycle)   "; done
</code></pre>
</div>

<h2 id="polarity">Polarity</h2>

<p>The “forward” direction of a motor can be changed using the <code class="highlighter-rouge">polarity</code> attribute.
This is useful, for example, when you have two motors used as drive wheels. By
changing the polarity of one of the two motors, you can send a positive value
to both motor to drive forwards.</p>

<p>Normally, the polarity is <code class="highlighter-rouge">normal</code>…</p>

<div class="highlighter-rouge"><pre class="highlight"><code>$ cat $MC/polarity
normal
</code></pre>
</div>

<p>Run the motor and see which way it rotates…</p>

<div class="highlighter-rouge"><pre class="highlight"><code>$ echo 300 &gt; $MC/speed_sp
$ echo run-forever &gt; $MC/command
$ while true; do echo -en "\033[0G$(cat $MC/position) $(cat $MC/speed)   "; done
</code></pre>
</div>

<p>The position is increasing and the speed is positive. Then change the polarity
to <code class="highlighter-rouge">inversed</code>…</p>

<div class="highlighter-rouge"><pre class="highlight"><code>$ echo inversed &gt; $MC/polarity
</code></pre>
</div>

<p>Like before, nothing happens. We have to send a command again…</p>

<div class="highlighter-rouge"><pre class="highlight"><code>$ echo run-forever &gt; $MC/command
</code></pre>
</div>

<p>…but still nothing happens. This is because changing the polarity inverted
all of the existing parameters.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>$ cat $MC/speed_sp
-300
</code></pre>
</div>

<p>So we have to set <code class="highlighter-rouge">speed_sp</code> to positive again to see the effect of the inverted
polarity.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>$ echo 300 &gt; $MC/speed_sp
$ echo run-forever &gt; $MC/command
$ while true; do echo -en "\033[0G$(cat $MC/position) $(cat $MC/speed)   "; done
</code></pre>
</div>

<p>Now, the motor runs in the opposite direction. Be sure to change to polarity back
to <code class="highlighter-rouge">normal</code> before continuing…</p>

<div class="highlighter-rouge"><pre class="highlight"><code>$ echo stop &gt; $MC/command
$ echo normal &gt; $MC/polarity
</code></pre>
</div>

<h2 id="ramping">Ramping</h2>

<p>TODO</p>

<h2 id="state-flags">State Flags</h2>

<p>You can monitor several aspects of the motor by reading the <code class="highlighter-rouge">state</code> attribute.
Possible values are <code class="highlighter-rouge">running</code>, <code class="highlighter-rouge">ramping</code>, <code class="highlighter-rouge">holding</code> and <code class="highlighter-rouge">stalled</code>. Reading the
attribute returns a space-separated list of flags, so use your programming
language’s string split function to split on the space (ascii 32) character to
get individual flags or use the string contains (or index of) function to test
for the presence of a flag.</p>

<h3 id="running">running</h3>

<p>This flag indicates that the motor is powered. This means that a run command is
active or if the stop command is <code class="highlighter-rouge">hold</code>, the motor is holding position. If the
power is low enough, the motor may not actually be moving even though the
<code class="highlighter-rouge">running</code> flag is present.</p>

<p>Note: To check that a run command is active when stop mode is <code class="highlighter-rouge">hold</code>, checking
the <code class="highlighter-rouge">running</code> flag is not enough. e.g. run-command-active = <code class="highlighter-rouge">running</code> and not
<code class="highlighter-rouge">holding</code>.</p>

<h3 id="ramping-1">ramping</h3>

<p>This flag indicates that the motor is ramping up or down rather than operating
at the duty cycle or speed setpoint.</p>

<h3 id="holding">holding</h3>

<p>This flag indicates that no run command is active but the motor is still being
powered to hold the position because the stop command is set to <code class="highlighter-rouge">hold</code>.</p>

<h3 id="stalled">stalled</h3>

<p>This flag indicates that a run command is trying to rotate the motor, but the
motor is not actually moving. This can be caused by something mechanically
preventing the motor from rotating or it could mean that the power being sent
to the motor is not enough (too small) to make the motor move.</p>




    
    </div>
    
    <div id="footer">

        <div class="cclicense">
    
            <span xmlns:dct="http://purl.org/dc/terms/" property="dct:title">
                www.ev3dev.org (with the exception of the projects pages)
            </span>
            is licensed under
            <a rel="license" href="http://creativecommons.org/licenses/by-sa/4.0/">
                <img alt="Creative Commons License" style="border-width:0" src="https://licensebuttons.net/l/by-sa/4.0/80x15.png" />
            </a>.
            <br />
            You are free to copy the text and images, but please be courteous and acknowledge the source.
    
        </div>

    <br />
    <div class="container">
        <span>
            Project maintained by <a href="https://github.com/rhempel">Ralph Hempel</a>
            and <a href="https://github.com/dlech">David Lechner</a>, with help from the community
        </span>
    </div>
</div>

    

<!-- Custom styles -->
<link rel="stylesheet" href="/ev3dev.github.io/stylesheets/search.css">
<link rel="stylesheet" href="/ev3dev.github.io/stylesheets/page-content.css">
<link rel="stylesheet" href="/ev3dev.github.io/stylesheets/user-cards.css">
<link rel="stylesheet" href="/ev3dev.github.io/stylesheets/tabs.css">

<!-- Python code highlighting -->
<link rel="stylesheet" href="/ev3dev.github.io/stylesheets/pygments/monokai.css" />

<!-- 3rd-party libraries -->
<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.0/jquery.min.js"></script>
<script src="/ev3dev.github.io/javascripts/bootstrap/bootstrap.min.js"></script>
<script src="/ev3dev.github.io/javascripts/jquery.getUrlParam.js"></script>
<script src="/ev3dev.github.io/javascripts/jquery.loadTemplate-1.4.4.min.js"></script>
<script src="/ev3dev.github.io/javascripts/respond.js"></script>
<script src="/ev3dev.github.io/javascripts/ua-parser.min.js"></script>
<script src="https://unpkg.com/imagesloaded@4.1/imagesloaded.pkgd.min.js"></script>


<!-- Caches data from requests to API endpoints -->
<script src="/ev3dev.github.io/javascripts/api-cache.js"></script>
<!-- Loads user-cards from GH API -->
<script src="/ev3dev.github.io/javascripts/cards.js"></script>
<!-- Configures special anchors to link to the most recent ev3dev release -->
<script src="/ev3dev.github.io/javascripts/releases.js"></script>
<!-- Responds to queries typed into the "Quick nav" box -->
<script src="/ev3dev.github.io/javascripts/search.js"></script>
<!-- Converts static descriptors of tab target content into live text and links -->
<script src="/ev3dev.github.io/javascripts/tabs.js"></script>
<!-- Adds classes and other styles to pages where hard-coded css can't be used -->
<script src="/ev3dev.github.io/javascripts/style-helpers.js"></script>
</body>
</html>

